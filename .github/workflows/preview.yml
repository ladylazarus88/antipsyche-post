name: âš¡ HTML Preview (Garantito)

on: workflow_dispatch

jobs:
  preview:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ Download posts
        run: |
          mkdir -p posts
          # Scarica i file .md dalla cartella posts/
          curl -s "https://api.github.com/repos/ladylazarus88/antipsyche-post/contents/posts" | \
            jq -r '.[] | select(.name | endswith(".md")) | .download_url' | \
            while read url; do
              filename=$(basename "$url")
              echo "Downloading $filename..."
              curl -s -o "posts/$filename" "$url"
            done
          
          echo "File scaricati:"
          ls -la posts/
          
      - name: ðŸŽ¨ Generate preview
        run: |
          # Crea una singola pagina HTML con i TUOI CSS
          cat > preview.html << 'EOF'
          <!DOCTYPE html>
          <html>
          <head>
              <title>Antipsyche Preview</title>
              <meta charset="utf-8">
              <style>
                  /* INCOLLA TUTTO IL TUO CSS GLOBALE QUI */
                  :root {
                      --color-accent: #c13127;
                      --color-text-primary: #222222;
                      --color-background: #ffffff;
                  }
                  
                  body {
                      font-family: 'Cormorant Garamond', serif;
                      color: var(--color-text-primary);
                      background: var(--color-background);
                      max-width: 800px;
                      margin: 0 auto;
                      padding: 2rem;
                  }
                  
                  .post {
                      border-left: 4px solid var(--color-accent);
                      padding-left: 2rem;
                      margin: 3rem 0;
                  }
                  
                  h1 {
                      color: var(--color-accent);
                      text-transform: uppercase;
                      letter-spacing: 0.15em;
                  }
                  
                  /* AGGIUNGI QUI ALTRI TUOI STILI */
              </style>
          </head>
          <body>
              <h1>ðŸŽ¨ Anteprima con il TUO stile</h1>
              <p>Il post apparirÃ  cosÃ¬ sul sito:</p>
          EOF
          
          # Aggiungi ogni post
          for file in posts/*.md; do
            if [ -f "$file" ]; then
              title=$(basename "$file" .md | sed 's/-/ /g')
              content=$(cat "$file")
              
              cat >> preview.html << EOF
              <div class="post">
                  <h2>${title}</h2>
                  <pre>${content}</pre>
              </div>
              EOF
            fi
          done
          
          cat >> preview.html << 'EOF'
          </body>
          </html>
          EOF
          
          echo "âœ… Preview HTML creata"
          ls -lh preview.html
          
      - name: ðŸ“¤ Upload as artifact
        uses: actions/upload-artifact@v3
        with:
          name: astro-preview
          path: preview.html
