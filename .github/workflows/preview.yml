name: ‚ö° Preview Funzionante

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  pages: write
  id-token: write

jobs:
  preview:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
      - name: üì• Get posts
        uses: actions/checkout@v4
        with:
          repository: ladylazarus88/antipsyche-post
          
      - name: üé® Create preview
        run: |
          mkdir -p _site
          
          # HTML base
          cat > _site/index.html << 'EOF'
          <!DOCTYPE html>
          <html>
          <head>
              <title>Antipsyche Preview</title>
              <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond&display=swap" rel="stylesheet">
              <style>
                  body { font-family: 'Cormorant Garamond', serif; padding: 2rem; }
                  h1 { color: #c13127; }
              </style>
          </head>
          <body>
              <h1>Antipsyche Preview</h1>
          EOF
          
          # Aggiungi post se esistono
          if [ -d "posts" ]; then
            for file in posts/*.md; do
              title=$(basename "$file" .md)
              echo "<h2>$title</h2>" >> _site/index.html
            done
          fi
          
          echo "</body></html>" >> _site/index.html
          
      - name: üì§ Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: _site
          
      - name: üåê Deploy
        uses: actions/deploy-pages@v3
